<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>图标管理</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen',
                'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue',
                sans-serif;
            background: linear-gradient(135deg, #1a1a1a, #000);
            color: #fff;
            height: 100vh;
            overflow: hidden;
        }

        .phone {
            height: 100vh;
            display: flex;
            flex-direction: column;
            position: relative;
        }

        /* 状态栏样式 */
        .status-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 15px;
            height: 44px;
            background-color: rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            color: white;
            font-size: 16px;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1000;
        }

        .status-left, .status-center, .status-right {
            display: flex;
            align-items: center;
        }

        .status-left {
            flex: 1;
        }

        .status-center {
            flex: 2;
            justify-content: center;
        }

        .status-right {
            flex: 1;
            justify-content: flex-end;
        }

        .status-icon {
            width: 18px;
            height: 18px;
            margin: 0 5px;
        }

        /* 头部导航栏 */
        .header {
            display: flex;
            align-items: center;
            padding: 0 15px;
            height: 50px;
            background-color: rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            position: fixed;
            top: 44px;
            left: 0;
            right: 0;
            z-index: 999;
        }

        /* 返回按钮 */
        .back-btn {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.15);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .back-btn svg {
            width: 18px;
            height: 18px;
            fill: white;
        }

        .header-title {
            flex: 1;
            text-align: center;
            font-size: 18px;
            font-weight: bold;
        }

        /* 主内容区域 */
        .content {
            flex: 1;
            display: flex;
            flex-direction: column;
            padding: 110px 20px 20px;
            overflow-y: auto;
        }

        /* 操作按钮区域 */
        .actions {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
        }

        .action-btn {
            flex: 1;
            padding: 15px;
            border-radius: 15px;
            background: rgba(255, 255, 255, 0.15);
            border: 1px solid rgba(255, 255, 255, 0.1);
            color: white;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }

        .action-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-2px);
        }

        .action-btn.primary {
            background: linear-gradient(45deg, #007AFF, #0A84FF);
        }

        .action-btn.primary:hover {
            background: linear-gradient(45deg, #007AFF, #0A84FF);
            box-shadow: 0 5px 15px rgba(10, 132, 255, 0.4);
        }

        .action-btn.danger {
            background: linear-gradient(135deg, #FF3B30, #FF453A);
        }

        .action-btn.danger:hover {
            background: linear-gradient(135deg, #FF3B30, #FF453A);
            box-shadow: 0 5px 15px rgba(255, 59, 48, 0.4);
        }

        /* 图标列表标题 */
        .section-title {
            font-size: 20px;
            font-weight: bold;
            margin: 20px 0 15px 0;
            padding-bottom: 10px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
        }

        /* 图标容器 */
        .icons-container {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin-bottom: 20px;
        }

        /* 图标项 */
        .icon-item {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 1px solid rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
        }

        .icon-item:hover {
            transform: translateY(-3px);
            background: rgba(255, 255, 255, 0.15);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }

        .icon-preview {
            width: 60px;
            height: 60px;
            border-radius: 15px;
            margin: 0 auto 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            background: rgba(255, 255, 255, 0.15);
        }

        .icon-preview img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .icon-preview svg {
            width: 30px;
            height: 30px;
            fill: white;
        }

        .icon-name {
            font-size: 14px;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .icon-status {
            font-size: 12px;
            color: #aaa;
        }

        .icon-status.custom {
            color: #007AFF;
        }

        /* 隐藏文件输入框 */
        .hidden-file-input {
            display: none;
        }

        /* 弹窗样式 */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .modal.active {
            opacity: 1;
            visibility: visible;
        }

        .modal-content {
            background: rgba(30, 30, 30, 0.95);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 25px;
            width: 90%;
            max-width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            border: 1px solid rgba(255, 255, 255, 0.1);
            transform: translateY(20px);
            transition: transform 0.3s ease;
        }

        .modal.active .modal-content {
            transform: translateY(0);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal-title {
            font-size: 20px;
            font-weight: bold;
        }

        .close-btn {
            background: transparent;
            border: none;
            color: white;
            font-size: 24px;
            cursor: pointer;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
        }

        .close-btn:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .modal-body {
            font-size: 16px;
            line-height: 1.6;
            margin-bottom: 20px;
        }

        .modal-actions {
            display: flex;
            gap: 10px;
        }

        .modal-btn {
            flex: 1;
            padding: 12px;
            border-radius: 12px;
            border: none;
            color: white;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }

        .modal-btn.cancel {
            background: rgba(255, 255, 255, 0.1);
        }

        .modal-btn.confirm {
            background: linear-gradient(135deg, #FF3B30, #FF453A);
        }

        .modal-btn.primary {
            background: linear-gradient(45deg, #007AFF, #0A84FF);
        }

        /* 图标选择弹窗 */
        .icon-select-modal .modal-content {
            max-width: 350px;
        }

        .upload-area {
            border: 2px dashed rgba(255, 255, 255, 0.2);
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            margin-bottom: 20px;
            transition: all 0.3s;
        }

        .upload-area:hover {
            border-color: rgba(0, 122, 255, 0.5);
            background: rgba(0, 122, 255, 0.05);
        }

        .upload-icon {
            font-size: 40px;
            margin-bottom: 10px;
        }

        .upload-text {
            font-size: 14px;
            color: #aaa;
        }

        .current-preview {
            width: 80px;
            height: 80px;
            border-radius: 15px;
            margin: 0 auto 15px;
            overflow: hidden;
            background: rgba(255, 255, 255, 0.15);
        }

        .current-preview img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .current-preview svg {
            width: 40px;
            height: 40px;
            fill: white;
            margin: 20px;
        }

        .preview-label {
            text-align: center;
            font-size: 14px;
            color: #aaa;
            margin-bottom: 15px;
        }
    </style>
</head>
<body>
    <div class="phone">
        <!-- 状态栏 -->
        <div class="status-bar">
            <div class="status-left">
                <span class="time" id="current-time">00:00</span>
            </div>
            <div class="status-center">
                <!-- 中间留空 -->
            </div>
            <div class="status-right">
                <!-- 信号图标 -->
                <svg class="status-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M5 17L5 12" stroke="white" stroke-width="2" stroke-linecap="round"/>
                    <path d="M12 17L12 7" stroke="white" stroke-width="2" stroke-linecap="round"/>
                    <path d="M19 17L19 2" stroke="white" stroke-width="2" stroke-linecap="round"/>
                </svg>
                <!-- 电池图标 -->
                <svg class="status-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <rect x="2" y="7" width="16" height="10" rx="3" stroke="white" stroke-width="2"/>
                    <path d="M20 10V14" stroke="white" stroke-width="2" stroke-linecap="round"/>
                    <rect x="4" y="9" width="12" height="6" rx="2" fill="white"/>
                </svg>
            </div>
        </div>

        <!-- 头部导航栏 -->
        <div class="header">
            <div class="back-btn" onclick="window.location.href='index.html'">
                <svg viewBox="0 0 24 24">
                    <path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"/>
                </svg>
            </div>
            <div class="header-title">图标管理</div>
            <div style="width: 30px;"></div> <!-- 占位符，保持标题居中 -->
        </div>

        <!-- 主内容 -->
        <div class="content">
            <div class="actions">
                <button class="action-btn primary" onclick="openRestoreAllModal()">
                    恢复所有默认图标
                </button>
            </div>

            <div class="section-title">主屏幕应用图标</div>
            <div class="icons-container" id="mainScreenIcons">
                <!-- 主屏幕图标将在这里动态生成 -->
            </div>

            <div class="section-title">Dock栏应用图标</div>
            <div class="icons-container" id="dockIcons">
                <!-- Dock栏图标将在这里动态生成 -->
            </div>
        </div>

        <!-- 图标选择弹窗 -->
        <div class="modal" id="iconSelectModal">
            <div class="modal-content">
                <div class="modal-header">
                    <div class="modal-title" id="selectModalTitle">选择图标</div>
                    <button class="close-btn" onclick="closeIconSelectModal()">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="preview-label">当前图标</div>
                    <div class="current-preview" id="currentPreview">
                        <!-- 当前图标预览将在这里显示 -->
                    </div>
                    <div class="upload-area" onclick="document.getElementById('iconUpload').click()">
                        <div class="upload-icon">📁</div>
                        <div class="upload-text">点击选择图片作为新图标</div>
                    </div>
                    <input type="file" id="iconUpload" class="hidden-file-input" accept="image/*" onchange="previewNewIcon(event)">
                    <div class="preview-label">预览效果</div>
                    <div class="current-preview" id="previewEffect">
                        <!-- 预览效果将在这里显示 -->
                    </div>
                </div>
                <div class="modal-actions">
                    <button class="modal-btn cancel" onclick="closeIconSelectModal()">取消</button>
                    <button class="modal-btn primary" onclick="saveCustomIcon()">保存</button>
                </div>
            </div>
        </div>

        <!-- 恢复确认弹窗 -->
        <div class="modal" id="restoreConfirmModal">
            <div class="modal-content">
                <div class="modal-header">
                    <div class="modal-title">确认恢复</div>
                    <button class="close-btn" onclick="closeRestoreConfirmModal()">&times;</button>
                </div>
                <div class="modal-body">
                    确定要恢复所有应用图标为默认样式吗？此操作将删除所有自定义图标设置。
                </div>
                <div class="modal-actions">
                    <button class="modal-btn cancel" onclick="closeRestoreConfirmModal()">取消</button>
                    <button class="modal-btn confirm" onclick="restoreAllIcons()">确定恢复</button>
                </div>
            </div>
        </div>

        <script>
            // 更新时间
            function updateTime() {
                const now = new Date();
                const timeString = now.toLocaleTimeString('zh-CN', { hour: '2-digit', minute: '2-digit' });
                document.getElementById('current-time').textContent = timeString;
            }

            // 每秒更新一次时间
            setInterval(updateTime, 1000);
            updateTime(); // 初始化时间

            // 当前正在编辑的图标信息
            let currentEditingIcon = null;

            // 应用数据
            const apps = [
                // 主屏幕应用
                { id: 'bizhi', name: '壁纸', type: 'main' },
                { id: 'shezhi', name: '设置', type: 'main' },
                { id: 'chat', name: '聊天', type: 'main' },
                { id: 'yinyue', name: '音乐', type: 'main' },
                // 第二页新添加的应用
                { id: 'riji', name: '日记', type: 'main' },
                { id: 'gouwu', name: '购物', type: 'main' },
                { id: 'luntan', name: '论坛', type: 'main' },
                { id: 'beiwanglu', name: '备忘录', type: 'main' },
                { id: 'qianbao', name: '钱包', type: 'main' },
                { id: 'dianhua', name: '电话', type: 'main' },
                { id: 'peiban', name: '陪伴', type: 'main' },
                { id: 'chouka', name: '抽卡', type: 'main' },
                // 名片头像
                { id: 'profile-avatar', name: '名片头像', type: 'main' },
                
                // Dock栏应用
                { id: 'jueseshu-dock', name: '角色书', type: 'dock' },
                { id: 'shijieshu-dock', name: '世界书', type: 'dock' },
                { id: 'shuomingshu-dock', name: '说明书', type: 'dock' },
                { id: 'tubiao-dock', name: '图标', type: 'dock' }
            ];

            // 默认图标SVG
            const defaultIcons = {
                'bizhi': '<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M4 16L9 11L13 15L20 8" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><rect x="3" y="3" width="18" height="18" rx="3" stroke="white" stroke-width="2"/></svg>',
                'shezhi': '<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M21 15C21 15.5304 20.7893 16.0391 20.4142 16.4142C20.0391 16.7893 19.5304 17 19 17H7L3 21V5C3 4.46957 3.21071 3.96086 3.58579 3.58579C3.96086 3.21071 4.46957 3 5 3H19C19.5304 3 20.0391 3.21071 20.4142 3.58579C20.7893 3.96086 21 4.46957 21 5V15Z" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>',
                'chat': '<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M21 11.5C21.0034 12.8199 20.6951 14.1219 20.1 15.3C19.3948 16.7262 18.3522 17.9555 17.05 18.9C15.7478 19.8445 14.2199 20.4861 12.58 20.77C11.9413 20.8791 11.2916 20.9135 10.64 20.88L7 22L8.12 18.36C7.38368 17.9462 6.71624 17.4224 6.14 16.8C4.72104 15.2441 3.92829 13.2159 4 11.1C4.00344 9.78012 4.31172 8.47814 4.90685 7.30001C5.61203 5.87386 6.65462 4.64455 7.95683 3.69999C9.25903 2.75544 10.7869 2.11382 12.4269 1.82999C14.0669 1.54616 15.7757 1.62764 17.42 2.06999C19.0643 2.51234 20.5975 3.30299 21.9 4.37999C23.2025 5.45699 24.15 7.02999 24.15 8.76999C24.1491 9.55042 24.0492 10.3261 23.85 11.07L24 11L21 11.5Z" stroke="white" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" fill="none"/><path d="M8 12H8.01" stroke="white" stroke-width="3" stroke-linecap="round"/><path d="M12 12H12.01" stroke="white" stroke-width="3" stroke-linecap="round"/><path d="M16 12H16.01" stroke="white" stroke-width="3" stroke-linecap="round"/></svg>',
                'dongtai': '<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M2 12C2 12 5 3 12 3C19 3 22 12 22 12C22 12 19 21 12 21C5 21 2 12 2 12Z" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M12 15C13.6569 15 15 13.6569 15 12C15 10.3431 13.6569 9 12 9C10.3431 9 9 10.3431 9 12C9 13.6569 10.3431 15 12 15Z" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>',
                'dongtaifabu': '<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12 22C17.5228 22 22 17.5228 22 12C22 6.47715 17.5228 2 12 2C6.47715 2 2 6.47715 2 12C2 17.5228 6.47715 22 12 22Z" stroke="white" stroke-width="2"/><path d="M12 8V16" stroke="white" stroke-width="2" stroke-linecap="round"/><path d="M8 12H16" stroke="white" stroke-width="2" stroke-linecap="round"/></svg>',
                'friends': '<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12 12C14.2091 12 16 10.2091 16 8C16 5.79086 14.2091 4 12 4C9.79086 4 8 5.79086 8 8C8 10.2091 9.79086 12 12 12Z" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M12 14C8.13401 14 5 17.134 5 21H19C19 17.134 15.866 14 12 14Z" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>',
                'jueseshu': '<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12 3C16.9706 3 21 7.02944 21 12C21 16.9706 16.9706 21 12 21C7.02944 21 3 16.9706 3 12C3 7.02944 7.02944 3 12 3Z" stroke="white" stroke-width="2"/><path d="M12 7V12L15 15" stroke="white" stroke-width="2" stroke-linecap="round"/><path d="M8 16C8.5 14.5 10 13.5 12 13.5C14 13.5 15.5 14.5 16 16" stroke="white" stroke-width="2" stroke-linecap="round"/></svg>',
                'liaotianyemian': '<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M8 12H8.01" stroke="white" stroke-width="3" stroke-linecap="round"/><path d="M12 12H12.01" stroke="white" stroke-width="3" stroke-linecap="round"/><path d="M16 12H16.01" stroke="white" stroke-width="3" stroke-linecap="round"/><rect x="3" y="3" width="18" height="18" rx="3" stroke="white" stroke-width="2"/></svg>',
                'wode': '<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="12" cy="8" r="4" stroke="white" stroke-width="2"/><path d="M4 20C4 15.5817 7.58172 12 12 12C16.4183 12 20 15.5817 20 20" stroke="white" stroke-width="2"/></svg>',
                'zhupingmu': '<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><rect x="3" y="3" width="18" height="18" rx="3" stroke="white" stroke-width="2"/><rect x="7" y="7" width="4" height="4" rx="1" stroke="white" stroke-width="2"/><rect x="13" y="13" width="4" height="4" rx="1" stroke="white" stroke-width="2"/><rect x="7" y="13" width="4" height="4" rx="1" stroke="white" stroke-width="2"/><rect x="13" y="7" width="4" height="4" rx="1" stroke="white" stroke-width="2"/></svg>',
                'shijieshu': '<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12 22C17.5228 22 22 17.5228 22 12C22 6.47715 17.5228 2 12 2C6.47715 2 2 6.47715 2 12C2 17.5228 6.47715 22 12 22Z" stroke="white" stroke-width="2"/><path d="M8 3H16" stroke="white" stroke-width="2" stroke-linecap="round"/><path d="M8 21H16" stroke="white" stroke-width="2" stroke-linecap="round"/><path d="M12 2V22" stroke="white" stroke-width="2" stroke-linecap="round"/><path d="M3 12H21" stroke="white" stroke-width="2" stroke-linecap="round"/><path d="M3 8L7 8" stroke="white" stroke-width="2" stroke-linecap="round"/><path d="M3 16L7 16" stroke="white" stroke-width="2" stroke-linecap="round"/><path d="M17 8L21 8" stroke="white" stroke-width="2" stroke-linecap="round"/><path d="M17 16L21 16" stroke="white" stroke-width="2" stroke-linecap="round"/></svg>',
                'shuomingshu': '<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M4 2H20C21.1046 2 22 2.89543 22 4V20C22 21.1046 21.1046 22 20 22H4C2.89543 22 2 21.1046 2 20V4C2 2.89543 2.89543 2 4 2Z" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M9 7H15" stroke="white" stroke-width="2" stroke-linecap="round"/><path d="M9 11H15" stroke="white" stroke-width="2" stroke-linecap="round"/><path d="M9 15H13" stroke="white" stroke-width="2" stroke-linecap="round"/></svg>',
                'tubiao': '<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12 22C17.5228 22 22 17.5228 22 12C22 6.47715 17.5228 2 12 2C6.47715 2 2 6.47715 2 12C2 17.5228 6.47715 22 12 22Z" stroke="white" stroke-width="2"/><circle cx="12" cy="12" r="3" stroke="white" stroke-width="2"/><path d="M3 12H21" stroke="white" stroke-width="2" stroke-linecap="round"/><path d="M12 3V21" stroke="white" stroke-width="2" stroke-linecap="round"/></svg>',
                'jueseshu-dock': '<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12 3C16.9706 3 21 7.02944 21 12C21 16.9706 16.9706 21 12 21C7.02944 21 3 16.9706 3 12C3 7.02944 7.02944 3 12 3Z" stroke="white" stroke-width="2"/><path d="M12 7V12L15 15" stroke="white" stroke-width="2" stroke-linecap="round"/><path d="M8 16C8.5 14.5 10 13.5 12 13.5C14 13.5 15.5 14.5 16 16" stroke="white" stroke-width="2" stroke-linecap="round"/></svg>',
                'shijieshu-dock': '<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12 22C17.5228 22 22 17.5228 22 12C22 6.47715 17.5228 2 12 2C6.47715 2 2 6.47715 2 12C2 17.5228 6.47715 22 12 22Z" stroke="white" stroke-width="2"/><path d="M8 3H16" stroke="white" stroke-width="2" stroke-linecap="round"/><path d="M8 21H16" stroke="white" stroke-width="2" stroke-linecap="round"/><path d="M12 2V22" stroke="white" stroke-width="2" stroke-linecap="round"/><path d="M3 12H21" stroke="white" stroke-width="2" stroke-linecap="round"/><path d="M3 8L7 8" stroke="white" stroke-width="2" stroke-linecap="round"/><path d="M3 16L7 16" stroke="white" stroke-width="2" stroke-linecap="round"/><path d="M17 8L21 8" stroke="white" stroke-width="2" stroke-linecap="round"/><path d="M17 16L21 16" stroke="white" stroke-width="2" stroke-linecap="round"/></svg>',
                'shuomingshu-dock': '<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M4 2H20C21.1046 2 22 2.89543 22 4V20C22 21.1046 21.1046 22 20 22H4C2.89543 22 2 21.1046 2 20V4C2 2.89543 2.89543 2 4 2Z" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M9 7H15" stroke="white" stroke-width="2" stroke-linecap="round"/><path d="M9 11H15" stroke="white" stroke-width="2" stroke-linecap="round"/><path d="M9 15H13" stroke="white" stroke-width="2" stroke-linecap="round"/></svg>',
                'tubiao-dock': '<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12 22C17.5228 22 22 17.5228 22 12C22 6.47715 17.5228 2 12 2C6.47715 2 2 6.47715 2 12C2 17.5228 6.47715 22 12 22Z" stroke="white" stroke-width="2"/><circle cx="12" cy="12" r="3" stroke="white" stroke-width="2"/><path d="M3 12H21" stroke="white" stroke-width="2" stroke-linecap="round"/><path d="M12 3V21" stroke="white" stroke-width="2" stroke-linecap="round"/></svg>',
                // 第二页新添加应用的默认图标
                'riji': '<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M4 19.5V4.5C4 3.5 5 2.5 6 2.5H17C18 2.5 19 3.5 19 4.5V19.5L12 16.5L4 19.5Z" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M9 9H15" stroke="white" stroke-width="2" stroke-linecap="round"/><path d="M9 13H13" stroke="white" stroke-width="2" stroke-linecap="round"/></svg>',
                'gouwu': '<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M6 2L3 6V20C3 20.5304 3.21071 21.0391 3.58579 21.4142C3.96086 21.7893 4.46957 22 5 22H19C19.5304 22 20.0391 21.7893 20.4142 21.4142C20.7893 21.0391 21 20.5304 21 20V6L18 2H6Z" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M3 6H21" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M16 10C16 11.0609 15.5786 12.0783 14.8284 12.8284C14.0783 13.5786 13.0609 14 12 14C10.9391 14 9.92172 13.5786 9.17157 12.8284C8.42143 12.0783 8 11.0609 8 10" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>',
                'luntan': '<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M21 15C21 15.5304 20.7893 16.0391 20.4142 16.4142C20.0391 16.7893 19.5304 17 19 17H7L3 21V5C3 4.46957 3.21071 3.96086 3.58579 3.58579C3.96086 3.21071 4.46957 3 5 3H19C19.5304 3 20.0391 3.21071 20.4142 3.58579C20.7893 3.96086 21 4.46957 21 5V15Z" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M16 10H16.01" stroke="white" stroke-width="3" stroke-linecap="round"/><path d="M12 10H12.01" stroke="white" stroke-width="3" stroke-linecap="round"/><path d="M8 10H8.01" stroke="white" stroke-width="3" stroke-linecap="round"/></svg>',
                'beiwanglu': '<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M4 6H20V18C20 19.1046 19.1046 20 18 20H6C4.89543 20 4 19.1046 4 18V6Z" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M4 10H20" stroke="white" stroke-width="2" stroke-linecap="round"/><path d="M9 14H10" stroke="white" stroke-width="2" stroke-linecap="round"/><path d="M9 17H12" stroke="white" stroke-width="2" stroke-linecap="round"/></svg>',
                'qianbao': '<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M3 7H21C21.5523 7 22 7.44772 22 8V17C22 17.5523 21.5523 18 21 18H3C2.44772 18 2 17.5523 2 17V8C2 7.44772 2.44772 7 3 7Z" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M2 12H4" stroke="white" stroke-width="2" stroke-linecap="round"/><path d="M18 12C18 13.1046 17.1046 14 16 14C14.8954 14 14 13.1046 14 12C14 10.8954 14.8954 10 16 10C17.1046 10 18 10.8954 18 12Z" stroke="white" stroke-width="2"/></svg>',
                'dianhua': '<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M3 6C3 5.44772 3.44772 5 4 5H20C20.5523 5 21 5.44772 21 6V18C21 18.5523 20.5523 19 20 19H4C3.44772 19 3 18.5523 3 18V6Z" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M8 7H16" stroke="white" stroke-width="2" stroke-linecap="round"/><path d="M8 11H16" stroke="white" stroke-width="2" stroke-linecap="round"/><path d="M8 15H13" stroke="white" stroke-width="2" stroke-linecap="round"/></svg>',
                'peiban': '<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12 12C14.2091 12 16 10.2091 16 8C16 5.79086 14.2091 4 12 4C9.79086 4 8 5.79086 8 8C8 10.2091 9.79086 12 12 12Z" stroke="white" stroke-width="2"/><path d="M6 20C6 17.7909 7.79086 16 10 16H14C16.2091 16 18 17.7909 18 20V20C18 21.1046 17.1046 22 16 22H8C6.89543 22 6 21.1046 6 20V20Z" stroke="white" stroke-width="2"/></svg>',
                'chouka': '<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M19 9L12 2L5 9M19 9V21C19 21.5304 18.7893 22.0391 18.4142 22.4142C18.0391 22.7893 17.5304 23 17 23H7C6.46957 23 5.96086 22.7893 5.58579 22.4142C5.21071 22.0391 5 21.5304 5 21V9M19 9H5" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M9 23V15C9 14.4696 9.21071 13.9609 9.58579 13.5858C9.96086 13.2107 10.4696 13 11 13H13C13.5304 13 14.0391 13.2107 14.4142 13.5858C14.7893 13.9609 15 14.4696 15 15V23" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>',
                // 名片头像默认图标
                'profile-avatar': '<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="12" cy="12" r="9" stroke="white" stroke-width="2"/><circle cx="12" cy="10" r="3" stroke="white" stroke-width="2"/><path d="M7 18C7 18 8 16 12 16C16 16 17 18 17 18" stroke="white" stroke-width="2" stroke-linecap="round"/></svg>'
            };

            // 音乐应用默认图标
            defaultIcons['yinyue'] = '<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12 3V12L19 5V19L12 12V21" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>';

            // 页面加载时初始化
            window.addEventListener('load', function() {
                updateTime();
                renderAppIcons();
            });

            // 渲染应用图标
            function renderAppIcons() {
                const mainScreenIcons = document.getElementById('mainScreenIcons');
                const dockIcons = document.getElementById('dockIcons');

                // 清空容器
                mainScreenIcons.innerHTML = '';
                dockIcons.innerHTML = '';

                // 分类渲染
                apps.forEach(app => {
                    const iconItem = document.createElement('div');
                    iconItem.className = 'icon-item';
                    
                    // 获取自定义图标或默认图标
                    const customIcon = localStorage.getItem(`customIcon_${app.id}`);
                    const isCustom = !!customIcon;
                    const iconContent = customIcon || defaultIcons[app.id] || '<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><rect x="3" y="3" width="18" height="18" rx="3" stroke="white" stroke-width="2"/></svg>';
                    
                    iconItem.innerHTML = `
                        <div class="icon-preview">
                            ${customIcon ? `<img src="${customIcon}" alt="${app.name}">` : iconContent}
                        </div>
                        <div class="icon-name">${app.name}</div>
                        <div class="icon-status ${isCustom ? 'custom' : ''}">${isCustom ? '自定义' : '默认'}</div>
                    `;
                    
                    // 添加点击事件
                    iconItem.onclick = () => openIconSelectModal(app, iconContent);
                    
                    // 根据类型添加到对应容器
                    if (app.type === 'main') {
                        mainScreenIcons.appendChild(iconItem);
                    } else if (app.type === 'dock') {
                        dockIcons.appendChild(iconItem);
                    }
                });
            }

            // 打开图标选择弹窗
            function openIconSelectModal(app, currentIcon) {
                if (!app || !currentIcon) {
                    alert('参数错误，无法打开图标选择器');
                    return;
                }
                
                currentEditingIcon = app;
                document.getElementById('selectModalTitle').textContent = `设置${app.name}图标`;
                
                // 显示当前图标
                const currentPreview = document.getElementById('currentPreview');
                const customIcon = localStorage.getItem(`customIcon_${app.id}`);
                if (customIcon) {
                    currentPreview.innerHTML = `<img src="${customIcon}" alt="当前图标">`;
                } else {
                    currentPreview.innerHTML = currentIcon;
                }
                
                // 清空预览效果
                document.getElementById('previewEffect').innerHTML = currentIcon;
                
                // 清空文件输入框
                document.getElementById('iconUpload').value = '';
                
                document.getElementById('iconSelectModal').classList.add('active');
            }

            // 关闭图标选择弹窗
            function closeIconSelectModal() {
                document.getElementById('iconSelectModal').classList.remove('active');
                currentEditingIcon = null;
            }

            // 预览新图标
            function previewNewIcon(event) {
                const file = event.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        try {
                            // 直接显示预览，不限制大小
                            document.getElementById('iconPreview').innerHTML = `<img src="${e.target.result}" alt="预览图标" style="width:100%;height:100%;object-fit:cover;border-radius:10px;">`;
                            document.getElementById('iconPreview').style.display = 'block';
                        } catch (error) {
                            console.error('预览图标时出错:', error);
                            alert('预览图标失败，请重试');
                            event.target.value = '';
                        }
                    };
                    reader.onerror = function(error) {
                        console.error('读取文件时出错:', error);
                        alert('读取文件时出错，请重试');
                        event.target.value = '';
                    };
                    reader.readAsDataURL(file);
                }
            }

            // 保存自定义图标 - 修复版本
            function saveCustomIcon() {
                const file = document.getElementById('iconUpload').files[0];
                if (!file) {
                    alert('请先选择一张图片');
                    return;
                }
                
                if (!currentEditingIcon) {
                    alert('未选择要修改的图标');
                    return;
                }
                
                // 保存当前编辑的图标引用，防止在异步操作中丢失
                const editingIcon = currentEditingIcon;
                
                // 显示保存中提示
                const saveBtn = document.querySelector('#iconSelectModal .modal-btn.primary');
                const originalText = saveBtn.textContent;
                saveBtn.textContent = '保存中...';
                saveBtn.disabled = true;
                
                // 创建FormData对象用于上传到postimages.org
                const formData = new FormData();
                formData.append('upload', file);
                
                // 上传图片到postimages.org
                fetch('https://postimages.org/json/1', {
                    method: 'POST',
                    body: formData
                })
                .then(response => response.json())
                .then(data => {
                    if (data.url) {
                        // 上传成功，保存图片URL而不是base64数据
                        try {
                            localStorage.setItem(`customIcon_${editingIcon.id}`, data.url);
                            
                            // 关闭弹窗
                            closeIconSelectModal();
                            
                            // 重新渲染图标列表
                            renderAppIcons();
                            
                            // 通知主屏幕更新图标
                            updateMainScreenIcons(editingIcon.id, data.url);
                            
                            // 显示成功提示
                            showSuccessMessage(`"${editingIcon.name}"图标已更新`);
                        } catch (error) {
                            console.error('保存图标URL时出错:', error);
                            alert('保存图标失败，请重试');
                        }
                    } else {
                        throw new Error('上传失败');
                    }
                })
                .catch(error => {
                    console.error('上传图片到postimages.org时出错:', error);
                    alert('上传图片失败，请检查网络连接后重试');
                })
                .finally(() => {
                    // 恢复按钮状态
                    saveBtn.textContent = originalText;
                    saveBtn.disabled = false;
                });
            }

            // 通知主屏幕更新图标
            function updateMainScreenIcons(iconId, iconData) {
                // 发送消息给主屏幕页面（如果它正在运行）
                if (window.opener && window.opener !== window) {
                    try {
                        window.opener.postMessage({
                            type: 'updateIcon',
                            iconId: iconId,
                            iconData: iconData
                        }, '*');
                    } catch (e) {
                        console.error('发送消息到主屏幕时出错:', e);
                    }
                }
                
                // 特殊处理：如果更新的是名片头像，也更新localStorage中的profileAvatar
                if (iconId === 'profile-avatar') {
                    try {
                        localStorage.setItem('profileAvatar', iconData);
                    } catch (e) {
                        console.error('保存名片头像到localStorage时出错:', e);
                        // 忽略错误，不提示用户
                    }
                }
            }

            // 打开恢复确认弹窗
            function openRestoreAllModal() {
                document.getElementById('restoreConfirmModal').classList.add('active');
            }

            // 关闭恢复确认弹窗
            function closeRestoreConfirmModal() {
                document.getElementById('restoreConfirmModal').classList.remove('active');
            }

            // 恢复所有图标
            function restoreAllIcons() {
                try {
                    // 显示恢复中提示
                    const restoreBtn = document.querySelector('#restoreConfirmModal .modal-btn.confirm');
                    const originalText = restoreBtn.textContent;
                    restoreBtn.textContent = '恢复中...';
                    restoreBtn.disabled = true;
                    
                    // 删除所有自定义图标
                    apps.forEach(app => {
                        localStorage.removeItem(`customIcon_${app.id}`);
                    });
                    
                    // 关闭弹窗
                    closeRestoreConfirmModal();
                    
                    // 重新渲染图标列表
                    renderAppIcons();
                    
                    // 通知主屏幕恢复所有图标
                    restoreMainScreenIcons();
                    
                    // 显示成功提示
                    showSuccessMessage('所有图标已恢复为默认样式');
                } catch (error) {
                    console.error('恢复图标时出错:', error);
                    alert('恢复图标失败，请重试');
                } finally {
                    // 恢复按钮状态
                    const restoreBtn = document.querySelector('#restoreConfirmModal .modal-btn.confirm');
                    if (restoreBtn) {
                        restoreBtn.textContent = originalText;
                        restoreBtn.disabled = false;
                    }
                }
            }

            // 通知主屏幕恢复所有图标
            function restoreMainScreenIcons() {
                // 发送消息给主屏幕页面（如果它正在运行）
                if (window.opener && window.opener !== window) {
                    try {
                        window.opener.postMessage({
                            type: 'restoreIcons'
                            // 不需要传递额外数据
                        }, '*');
                    } catch (e) {
                        console.error('发送恢复图标消息时出错:', e);
                    }
                }
            }

            // 显示成功提示
            function showSuccessMessage(message) {
                // 创建提示元素
                const alertElement = document.createElement('div');
                alertElement.style.cssText = `
                    position: fixed;
                    top: 50%;
                    left: 50%;
                    transform: translate(-50%, -50%);
                    background: rgba(0, 0, 0, 0.8);
                    color: white;
                    padding: 20px;
                    border-radius: 10px;
                    z-index: 2000;
                    text-align: center;
                    backdrop-filter: blur(10px);
                    border: 1px solid rgba(255, 255, 255, 0.1);
                    max-width: 80%;
                `;
                alertElement.textContent = message;
                
                // 添加到页面
                document.body.appendChild(alertElement);
                
                // 3秒后自动移除
                setTimeout(() => {
                    if (alertElement.parentNode) {
                        alertElement.parentNode.removeChild(alertElement);
                    }
                }, 3000);
            }
        </script>
    </div>
</body>
</html>
